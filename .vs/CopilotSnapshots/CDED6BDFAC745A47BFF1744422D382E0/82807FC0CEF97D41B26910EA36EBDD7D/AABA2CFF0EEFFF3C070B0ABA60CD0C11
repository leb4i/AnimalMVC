@model IEnumerable<animalsMVC.Models.Animal>

@{
    ViewData["Title"] = "Animals";
}

<div class="animals-page">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="page-title">Animals</h1>
        @if (User.IsInRole("Admin"))
        {
            <a asp-action="Create" class="btn btn-success">Add Animal</a>
        }
    </div>

    <div class="card">
        <div class="card-body p-0">
            <table class="table animals-table mb-0">
    <thead>
        <tr>
            <th>Image</th>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Type)
            </th>
            <th></th>
        </tr>
    </thead>

    <tbody>
@foreach (var item in Model) {
    var firstImage = "";
    if (!string.IsNullOrWhiteSpace(item.ImageFiles))
    {
        var parts = item.ImageFiles.Split(',', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
        if (parts.Any())
        {
            firstImage = Url.Content($"~/images/animals/{parts[0]}");
        }
    }
    
    if (string.IsNullOrEmpty(firstImage))
    {
        // fallback: try to construct filename from id
        firstImage = Url.Content($"~/images/animals/{item.Id}-preview.jpg");
    }
        <tr>
            <td>
                <img src="@firstImage" alt="@item.Name" class="img-thumbnail" style="width:60px; height:60px; object-fit:cover;" onerror="this.src='/images/animals/animal-1.svg';" />
            </td>
            <td>
                <strong>@Html.DisplayFor(modelItem => item.Name)</strong>
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Type)
            </td>
            <td class="action-links text-end">
                @if (User.IsInRole("Admin"))
                {
                    <a class="btn btn-sm btn-outline-primary" asp-action="Edit" asp-route-id="@item.Id">Edit</a>
                }
                <a class="btn btn-sm btn-outline-secondary" asp-action="Details" asp-route-id="@item.Id">Details</a>
                @if (User.IsInRole("Admin"))
                {
                    <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                }
            </td>
        </tr>
}
    </tbody>
            </table>
        </div>
    </div>
</div>

